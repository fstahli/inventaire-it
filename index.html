<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Inventaire IT</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Inventaire IT">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSI0MCIgZmlsbD0iIzJjM2U1MCIvPjx0ZXh0IHg9IjkwIiB5PSIxMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4MCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfk6Y8L3RleHQ+PC9zdmc+">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI4IiBmaWxsPSIjMmMzZTUwIi8+PHRleHQgeD0iMTYiIHk9IjIyIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5OmPC90ZXh0Pjwvc3ZnPg==">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .status-indicator {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 0.85em;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .status-online {
            background: rgba(46, 204, 113, 0.9);
            color: white;
            box-shadow: 0 8px 32px rgba(46, 204, 113, 0.3);
        }
        
        .status-syncing {
            background: rgba(241, 196, 15, 0.9);
            color: white;
            box-shadow: 0 8px 32px rgba(241, 196, 15, 0.3);
        }
        
        .status-offline {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            box-shadow: 0 8px 32px rgba(231, 76, 60, 0.3);
        }
        
        .sync-info {
            background: linear-gradient(135deg, #e8f5e8, #d5f4e6);
            border: 2px solid #27ae60;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            font-size: 0.95em;
            color: #27ae60;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.1);
        }
        
        .config-section {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #f39c12;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.1);
        }
        
        .config-section h3 {
            color: #f39c12;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .collapsible-section {
            margin-bottom: 30px;
        }
        
        .section-toggle {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 16px 25px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.2);
        }
        
        .section-toggle:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(52, 152, 219, 0.3);
        }
        
        .section-toggle.active {
            background: linear-gradient(135deg, #27ae60, #219a52);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.2);
        }
        
        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
        
        .section-content {
            display: none;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 0 0 12px 12px;
            border: 2px solid #e9ecef;
            border-top: none;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input, .form-group select {
            padding: 15px 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }
        
        .config-input {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.9em;
            border: 2px solid #f39c12;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(52, 152, 219, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }
        
        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, #219a52, #1e8449);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(39, 174, 96, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 10px 15px;
            font-size: 0.85em;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.4);
        }
        
        .btn-quantity {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-quantity:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-quantity.decrease {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-quantity.decrease:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .btn-quantity.increase {
            background: linear-gradient(135deg, #27ae60, #219a52);
        }
        
        .btn-quantity.increase:hover {
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .actions {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 40px;
            justify-content: center;
        }
        
        .inventory-container {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .inventory-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
            font-weight: 600;
            font-size: 1.3em;
            position: relative;
        }
        
        .inventory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .inventory-grid {
            display: grid;
            gap: 1px;
            background: #e9ecef;
        }
        
        .grid-header {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 120px 80px 100px;
            background: #34495e;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .grid-header > div {
            padding: 20px 15px;
            display: flex;
            align-items: center;
        }
        
        .grid-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 120px 80px 100px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .grid-row:hover {
            background: #f8f9fa;
            transform: translateX(5px);
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        }
        
        .grid-cell {
            padding: 20px 15px;
            display: flex;
            align-items: center;
            font-size: 0.95em;
            border-right: 1px solid #ecf0f1;
        }
        
        .grid-cell:last-child {
            border-right: none;
            justify-content: center;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .quantity-display {
            font-weight: 700;
            font-size: 1.1em;
            color: #2c3e50;
            min-width: 35px;
            text-align: center;
        }
        
        .state-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .state-neuf {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .state-bon {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #99ccff;
        }
        
        .state-moyen {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .state-defaillant {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            color: #7f8c8d;
            background: white;
        }
        
        .empty-icon {
            font-size: 5em;
            margin-bottom: 25px;
            opacity: 0.3;
        }
        
        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .search-box {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
            background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E") no-repeat 18px center;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2em;
            }
            
            .main-content {
                padding: 25px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .actions {
                justify-content: stretch;
            }
            
            .actions .btn {
                flex: 1;
            }
            
            .grid-header, .grid-row {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .grid-header {
                display: none;
            }
            
            .grid-cell {
                padding: 10px;
                border-right: none;
                border-bottom: 1px solid #ecf0f1;
                justify-content: center;
            }
            
            .grid-cell::before {
                content: attr(data-label);
                font-weight: 600;
                color: #7f8c8d;
                margin-right: 10px;
                font-size: 0.8em;
                text-transform: uppercase;
            }
            
            .status-indicator {
                position: static;
                margin-bottom: 20px;
                text-align: center;
            }
            
            .inventory-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Indicateur de statut -->
    <div id="status-indicator" class="status-indicator status-offline">
        🔄 Initialisation...
    </div>
    
    <div class="container">
        <div class="header">
            <h1>📦 Inventaire IT Pro</h1>
            <p>Gestion intelligente des stocks • Synchronisation cloud</p>
        </div>
        
        <div class="main-content">
            <!-- Section de configuration GitHub -->
            <div id="config-section" class="config-section">
                <h3>⚙️ Configuration GitHub</h3>
                <p style="margin-bottom: 20px; color: #856404;">Configurez la synchronisation automatique avec GitHub :</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Nom d'utilisateur GitHub</label>
                        <input type="text" id="github-username" class="config-input" placeholder="votre-nom-utilisateur">
                    </div>
                    <div class="form-group">
                        <label>Nom du repository</label>
                        <input type="text" id="github-repo" class="config-input" placeholder="inventaire-it">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Token d'accès GitHub</label>
                    <input type="password" id="github-token" class="config-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <small style="color: #856404; margin-top: 8px; display: block;">
                        Créez un token sur GitHub: Settings → Developer settings → Personal access tokens
                    </small>
                </div>
                
                <button onclick="saveGitHubConfig()" class="btn btn-primary">💾 Activer la synchronisation</button>
            </div>
            
            <div class="sync-info">
                <strong>🌟 Synchronisation GitHub activée !</strong><br>
                Vos données sont automatiquement sauvegardées et synchronisées entre tous vos appareils en temps réel.
            </div>
            
            <!-- Section pliable pour ajouter des articles -->
            <div class="collapsible-section">
                <button class="section-toggle" id="add-toggle" onclick="toggleSection('add-section')">
                    ➕ Ajouter un nouvel équipement
                    <span class="toggle-icon" id="add-icon">🔽</span>
                </button>
                <div class="section-content" id="add-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="type">Type d'équipement</label>
                            <select id="type">
                                <option value="Écran">Écran</option>
                                <option value="Souris">Souris</option>
                                <option value="Clavier">Clavier</option>
                                <option value="Ordinateur">Ordinateur</option>
                                <option value="Imprimante">Imprimante</option>
                                <option value="Câble">Câble</option>
                                <option value="Casque">Casque</option>
                                <option value="Webcam">Webcam</option>
                                <option value="Adaptateur">Adaptateur</option>
                                <option value="custom">➕ Nouvel équipement</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="custom-type-group" style="display: none;">
                            <label for="custom-type">Nom du nouvel équipement</label>
                            <input type="text" id="custom-type" placeholder="Ex: Tablette graphique">
                        </div>
                        
                        <div class="form-group">
                            <label for="marque">Marque</label>
                            <input type="text" id="marque" placeholder="Ex: Dell, HP, Logitech... (optionnel)">
                        </div>
                        
                        <div class="form-group">
                            <label for="modele">Modèle</label>
                            <input type="text" id="modele" placeholder="Ex: OptiPlex 7090 (optionnel)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="etat">État</label>
                            <select id="etat">
                                <option value="Neuf">Neuf</option>
                                <option value="Bon">Bon</option>
                                <option value="Moyen">Moyen</option>
                                <option value="Défaillant">Défaillant</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantite">Quantité</label>
                            <input type="number" id="quantite" placeholder="1" min="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <input type="text" id="notes" placeholder="Commentaires optionnels">
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-primary" id="add-btn" onclick="ajouterItem()">✨ Ajouter à l'inventaire</button>
                    </div>
                </div>
            </div>
            
            <div class="actions">
                <button class="btn btn-success" onclick="exporterPDF()">📄 Exporter en PDF</button>
                <button class="btn btn-primary" id="sync-btn" onclick="synchroniser()">🔄 Synchroniser</button>
            </div>
            
            <!-- Inventaire principal -->
            <div class="inventory-container">
                <div class="inventory-header">
                    📋 Inventaire des équipements
                </div>
                
                <div class="inventory-stats" id="inventory-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-references">0</div>
                        <div class="stat-label">Références</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-items">0</div>
                        <div class="stat-label">Articles</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-value">0</div>
                        <div class="stat-label">En bon état</div>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" placeholder="Rechercher dans l'inventaire..." onkeyup="filtrerInventaire()">
                </div>
                
                <div id="inventory-container">
                    <div class="empty-state">
                        <div class="empty-icon">📦</div>
                        <h3>Aucun équipement dans l'inventaire</h3>
                        <p>Ajoutez votre premier équipement pour commencer la gestion des stocks</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Types d'équipements par défaut
        let typesEquipements = [
            'Écran', 'Souris', 'Clavier', 'Ordinateur', 'Imprimante', 
            'Câble', 'Casque', 'Webcam', 'Adaptateur'
        ];

        // Variables globales
        let inventaire = [];
        let idCounter = 1;
        let githubConfig = null;
        let isConfigured = false;
        let inventaireFiltré = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubConfig();
            
            // Gérer le type personnalisé
            document.getElementById('type').addEventListener('change', function() {
                const customGroup = document.getElementById('custom-type-group');
                if (this.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
            });
        });

        function loadGitHubConfig() {
            const saved = localStorage.getItem('github-config');
            if (saved) {
                try {
                    githubConfig = JSON.parse(saved);
                    isConfigured = true;
                    document.getElementById('config-section').style.display = 'none';
                    updateStatusIndicator('online');
                    chargerDepuisGitHub();
                } catch (e) {
                    console.error('Erreur configuration:', e);
                }
            } else {
                updateStatusIndicator('offline');
                chargerDepuisLocal();
            }
            
            // Charger les types personnalisés
            chargerTypesEquipements();
            mettreAJourListeTypes();
        }

        function chargerTypesEquipements() {
            const savedTypes = localStorage.getItem('types-equipements');
            if (savedTypes) {
                try {
                    const customTypes = JSON.parse(savedTypes);
                    // Fusionner avec les types par défaut sans doublons
                    typesEquipements = [...new Set([...typesEquipements, ...customTypes])];
                } catch (e) {
                    console.error('Erreur chargement types:', e);
                }
            }
        }

        function sauvegarderTypesEquipements() {
            // Sauvegarder uniquement les types personnalisés (pas ceux par défaut)
            const typesDefaut = ['Écran', 'Souris', 'Clavier', 'Ordinateur', 'Imprimante', 'Câble', 'Casque', 'Webcam', 'Adaptateur'];
            const typesPersonnalises = typesEquipements.filter(type => !typesDefaut.includes(type));
            localStorage.setItem('types-equipements', JSON.stringify(typesPersonnalises));
        }

        function mettreAJourListeTypes() {
            const selectType = document.getElementById('type');
            // Conserver la sélection actuelle
            const currentValue = selectType.value;
            
            // Vider et reconstruire la liste
            selectType.innerHTML = '';
            
            // Ajouter tous les types (triés alphabétiquement)
            const typesTries = [...typesEquipements].sort();
            typesTries.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                selectType.appendChild(option);
            });
            
            // Ajouter l'option pour nouveau type
            const optionCustom = document.createElement('option');
            optionCustom.value = 'custom';
            optionCustom.textContent = '➕ Nouvel équipement';
            selectType.appendChild(optionCustom);
            
            // Restaurer la sélection si elle existe encore
            if (typesTries.includes(currentValue)) {
                selectType.value = currentValue;
            }
        }

        function saveGitHubConfig() {
            const username = document.getElementById('github-username').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            const token = document.getElementById('github-token').value.trim();

            if (!username || !repo || !token) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            githubConfig = { username, repo, token };
            localStorage.setItem('github-config', JSON.stringify(githubConfig));
            isConfigured = true;
            document.getElementById('config-section').style.display = 'none';
            updateStatusIndicator('online');
            synchroniser();
        }

        function updateStatusIndicator(status) {
            const indicator = document.getElementById('status-indicator');
            switch (status) {
                case 'online':
                    indicator.className = 'status-indicator status-online';
                    indicator.innerHTML = '✅ Synchronisé avec GitHub';
                    break;
                case 'syncing':
                    indicator.className = 'status-indicator status-syncing';
                    indicator.innerHTML = '🔄 Synchronisation...';
                    break;
                case 'offline':
                    indicator.className = 'status-indicator status-offline';
                    indicator.innerHTML = '📱 Mode local';
                    break;
            }
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const toggle = document.getElementById(sectionId.replace('-section', '-toggle'));
            const icon = document.getElementById(sectionId.replace('-section', '-icon'));
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                toggle.classList.add('active');
                icon.classList.add('rotated');
                icon.textContent = '🔼';
            } else {
                content.style.display = 'none';
                toggle.classList.remove('active');
                icon.classList.remove('rotated');
                icon.textContent = '🔽';
            }
        }

        async function chargerDepuisGitHub() {
            if (!isConfigured) return;
            
            updateStatusIndicator('syncing');
            
            try {
                const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/inventaire.json`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                    inventaire = content.items || [];
                    inventaire.forEach(item => {
                        if (!item.quantite) item.quantite = 1;
                    });
                    if (inventaire.length > 0) {
                        idCounter = Math.max(...inventaire.map(item => item.id)) + 1;
                    }
                    afficherInventaire();
                    updateStatusIndicator('online');
                } else if (response.status === 404) {
                    await sauvegarderVersGitHub();
                } else {
                    throw new Error(`Erreur GitHub: ${response.status}`);
                }
            } catch (error) {
                console.error('Erreur chargement GitHub:', error);
                chargerDepuisLocal();
                updateStatusIndicator('offline');
            }
        }

        async function sauvegarderVersGitHub() {
            if (!isConfigured) return;
            
            updateStatusIndicator('syncing');
            
            try {
                const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/inventaire.json`;
                
                let sha = null;
                try {
                    const existingResponse = await fetch(url, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        sha = existingData.sha;
                    }
                } catch (e) {
                    // Fichier n'existe pas
                }

                const data = {
                    items: inventaire,
                    lastUpdate: Date.now(),
                    version: '2.0'
                };

                const payload = {
                    message: `Mise à jour inventaire IT - ${new Date().toLocaleString('fr-FR')}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))),
                    committer: {
                        name: 'Inventaire IT Pro',
                        email: 'inventaire@app.local'
                    }
                };

                if (sha) payload.sha = sha;

                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    updateStatusIndicator('online');
                } else {
                    throw new Error(`Erreur sauvegarde: ${response.status}`);
                }
            } catch (error) {
                console.error('Erreur sauvegarde GitHub:', error);
                updateStatusIndicator('offline');
            }
        }

        function chargerDepuisLocal() {
            try {
                const saved = localStorage.getItem('inventaire-it');
                if (saved) {
                    inventaire = JSON.parse(saved);
                    inventaire.forEach(item => {
                        if (!item.quantite) item.quantite = 1;
                    });
                    if (inventaire.length > 0) {
                        idCounter = Math.max(...inventaire.map(item => item.id)) + 1;
                    }
                    afficherInventaire();
                }
            } catch (e) {
                console.error('Erreur chargement local:', e);
            }
        }

        async function synchroniser() {
            if (isConfigured) {
                await chargerDepuisGitHub();
            } else {
                alert('Veuillez d\'abord configurer GitHub');
            }
        }

        async function ajouterItem() {
            let type = document.getElementById('type').value;
            const customType = document.getElementById('custom-type').value.trim();
            const marque = document.getElementById('marque').value.trim();
            const modele = document.getElementById('modele').value.trim();
            const etat = document.getElementById('etat').value;
            const notes = document.getElementById('notes').value.trim();
            const quantite = parseInt(document.getElementById('quantite').value) || 1;

            if (type === 'custom') {
                if (!customType) {
                    alert('Veuillez renseigner le nom du nouvel équipement');
                    return;
                }
                type = customType;
                
                // Ajouter le nouveau type à la liste s'il n'existe pas déjà
                if (!typesEquipements.includes(type)) {
                    typesEquipements.push(type);
                    sauvegarderTypesEquipements();
                    mettreAJourListeTypes();
                    // Sélectionner automatiquement le nouveau type
                    document.getElementById('type').value = type;
                }
            }

            // Si ni marque ni modèle ne sont renseignés, demander au moins l'un des deux
            if (!marque && !modele) {
                alert('Veuillez renseigner au moins la marque ou le modèle');
                return;
            }

            // Vérifier si un article similaire existe déjà
            const articleExistant = inventaire.find(item => 
                item.type === type && 
                (item.marque || '').toLowerCase() === marque.toLowerCase() &&
                (item.modele || '').toLowerCase() === modele.toLowerCase() &&
                item.etat === etat
            );

            if (articleExistant) {
                if (confirm(`Un article similaire existe déjà (Quantité: ${articleExistant.quantite}). Voulez-vous augmenter sa quantité de ${quantite} ?`)) {
                    articleExistant.quantite += quantite;
                    if (notes) articleExistant.notes = notes;
                    articleExistant.timestamp = Date.now();
                    await sauvegarderInventaire();
                    afficherInventaire();
                    viderFormulaire();
                }
                return;
            }

            const nouvelItem = {
                id: idCounter++,
                type,
                marque: marque || '',
                modele: modele || '',
                etat,
                notes,
                quantite,
                timestamp: Date.now()
            };

            inventaire.push(nouvelItem);
            await sauvegarderInventaire();
            afficherInventaire();
            viderFormulaire();
        }

        async function modifierQuantite(id, changement) {
            const item = inventaire.find(i => i.id === id);
            if (!item) return;

            const nouvelleQuantite = (item.quantite || 1) + changement;
            
            if (nouvelleQuantite <= 0) {
                if (confirm('La quantité sera de 0. Voulez-vous supprimer cet article ?')) {
                    await supprimerItem(id);
                }
                return;
            }

            item.quantite = nouvelleQuantite;
            item.timestamp = Date.now();
            await sauvegarderInventaire();
            afficherInventaire();
        }

        async function supprimerItem(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet élément ?')) {
                inventaire = inventaire.filter(item => item.id !== id);
                await sauvegarderInventaire();
                afficherInventaire();
            }
        }

        async function sauvegarderInventaire() {
            try {
                localStorage.setItem('inventaire-it', JSON.stringify(inventaire));
            } catch (e) {
                console.error('Erreur sauvegarde locale:', e);
            }

            if (isConfigured) {
                await sauvegarderVersGitHub();
            }
        }

        function filtrerInventaire() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            inventaireFiltré = inventaire.filter(item => 
                item.type.toLowerCase().includes(searchTerm) ||
                item.marque.toLowerCase().includes(searchTerm) ||
                (item.modele && item.modele.toLowerCase().includes(searchTerm)) ||
                item.etat.toLowerCase().includes(searchTerm) ||
                (item.notes && item.notes.toLowerCase().includes(searchTerm))
            );
            afficherInventaire();
        }

        function afficherInventaire() {
            const container = document.getElementById('inventory-container');
            const itemsToShow = inventaireFiltré.length > 0 || document.getElementById('search-input').value ? inventaireFiltré : inventaire;
            
            // Mettre à jour les statistiques
            updateStatistics();

            if (itemsToShow.length === 0) {
                const searchValue = document.getElementById('search-input').value;
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${searchValue ? '🔍' : '📦'}</div>
                        <h3>${searchValue ? 'Aucun résultat trouvé' : 'Aucun équipement dans l\'inventaire'}</h3>
                        <p>${searchValue ? 'Essayez avec d\'autres mots-clés' : 'Ajoutez votre premier équipement pour commencer'}</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="inventory-grid">
                    <div class="grid-header">
                        <div>Type & Marque</div>
                        <div>Modèle</div>
                        <div>État</div>
                        <div>Quantité</div>
                        <div>Notes</div>
                        <div>Actions</div>
                    </div>
            `;

            itemsToShow.forEach(item => {
                html += `
                    <div class="grid-row">
                        <div class="grid-cell" data-label="Type & Marque">
                            <div>
                                <div style="font-weight: 600; color: #2c3e50;">${item.type}</div>
                                <div style="color: #7f8c8d; font-size: 0.9em;">${item.marque || '-'}</div>
                            </div>
                        </div>
                        <div class="grid-cell" data-label="Modèle">${item.modele || '-'}</div>
                        <div class="grid-cell" data-label="État">
                            <span class="state-badge state-${item.etat.toLowerCase()}">${item.etat}</span>
                        </div>
                        <div class="grid-cell" data-label="Quantité">
                            <div class="quantity-controls">
                                <button onclick="modifierQuantite(${item.id}, -1)" class="btn-quantity decrease">-</button>
                                <span class="quantity-display">${item.quantite || 1}</span>
                                <button onclick="modifierQuantite(${item.id}, 1)" class="btn-quantity increase">+</button>
                            </div>
                        </div>
                        <div class="grid-cell" data-label="Notes">${item.notes || '-'}</div>
                        <div class="grid-cell" data-label="Actions">
                            <button class="btn btn-danger" onclick="supprimerItem(${item.id})">🗑️</button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function updateStatistics() {
            const totalReferences = inventaire.length;
            const totalItems = inventaire.reduce((sum, item) => sum + (item.quantite || 1), 0);
            const bonEtat = inventaire.filter(item => item.etat === 'Neuf' || item.etat === 'Bon')
                .reduce((sum, item) => sum + (item.quantite || 1), 0);

            document.getElementById('total-references').textContent = totalReferences;
            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('total-value').textContent = bonEtat;
        }

        function viderFormulaire() {
            // Ne pas réinitialiser le type s'il vient d'être ajouté
            const currentType = document.getElementById('type').value;
            if (currentType === 'custom' || !typesEquipements.includes(currentType)) {
                document.getElementById('type').selectedIndex = 0; // Premier type de la liste
            }
            
            document.getElementById('custom-type').value = '';
            document.getElementById('custom-type-group').style.display = 'none';
            document.getElementById('marque').value = '';
            document.getElementById('modele').value = '';
            document.getElementById('etat').value = 'Neuf';
            document.getElementById('notes').value = '';
            document.getElementById('quantite').value = '1';
        }

        function exporterPDF() {
            if (inventaire.length === 0) {
                alert('Aucun élément à exporter');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // Paysage pour plus d'espace

            // Configuration des couleurs
            const primaryColor = [44, 62, 80];
            const secondaryColor = [52, 73, 94];
            const accentColor = [52, 152, 219];

            // En-tête avec titre simplifié
            doc.setFillColor(...primaryColor);
            doc.rect(0, 0, 297, 25, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont('helvetica', 'bold');
            doc.text('INVENTAIRE IT', 20, 17);

            // Date du rapport
            doc.setTextColor(...primaryColor);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('fr-FR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            }).replace(/é/g, 'e').replace(/è/g, 'e').replace(/à/g, 'a').replace(/ç/g, 'c');
            const timeStr = now.toLocaleTimeString('fr-FR');
            
            doc.text(`Genere le ${dateStr} a ${timeStr}`, 20, 35);

            // Tableau principal
            const colonnes = [
                { header: 'Type', dataKey: 'type' },
                { header: 'Marque', dataKey: 'marque' },
                { header: 'Modele', dataKey: 'modele' },
                { header: 'Etat', dataKey: 'etat' },
                { header: 'Qte', dataKey: 'quantite' },
                { header: 'Notes', dataKey: 'notes' }
            ];

            const donnees = inventaire.map(item => ({
                type: item.type,
                marque: item.marque || 'Sans marque',
                modele: item.modele || '-',
                etat: item.etat,
                quantite: item.quantite || 1,
                notes: (item.notes || '-').replace(/é/g, 'e').replace(/è/g, 'e').replace(/à/g, 'a').replace(/ç/g, 'c')
            }));

            doc.autoTable({
                columns: colonnes,
                body: donnees,
                startY: 50,
                styles: { 
                    fontSize: 9,
                    cellPadding: 4,
                    lineColor: [230, 230, 230],
                    lineWidth: 0.5
                },
                headStyles: { 
                    fillColor: primaryColor,
                    textColor: [255, 255, 255],
                    fontSize: 10,
                    fontStyle: 'bold',
                    halign: 'center'
                },
                alternateRowStyles: { 
                    fillColor: [248, 249, 250] 
                },
                columnStyles: {
                    0: { cellWidth: 35 },
                    1: { cellWidth: 40 },
                    2: { cellWidth: 45 },
                    3: { cellWidth: 25, halign: 'center' },
                    4: { cellWidth: 20, halign: 'center' },
                    5: { cellWidth: 60 }
                },
                didDrawCell: function(data) {
                    // Colorier les états
                    if (data.column.dataKey === 'etat') {
                        const etat = data.cell.raw;
                        let color;
                        switch(etat) {
                            case 'Neuf': color = [212, 237, 218]; break;
                            case 'Bon': color = [204, 229, 255]; break;
                            case 'Moyen': color = [255, 243, 205]; break;
                            case 'Défaillant': color = [248, 215, 218]; break;
                            default: color = [255, 255, 255];
                        }
                        doc.setFillColor(...color);
                        doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                        doc.setTextColor(44, 62, 80);
                        doc.text(etat, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2 + 1, { align: 'center' });
                    }
                }
            });

            // Pied de page simplifié
            const pageHeight = doc.internal.pageSize.getHeight();
            doc.setFillColor(...secondaryColor);
            doc.rect(0, pageHeight - 15, 297, 15, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('Inventaire IT', 20, pageHeight - 8);
            
            const totalItems = inventaire.reduce((sum, item) => sum + (item.quantite || 1), 0);
            doc.text(`${totalItems} articles au total`, 250, pageHeight - 8);

            // Sauvegarder avec un nom personnalisé
            const fileName = `Inventaire-IT-${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}.pdf`;
            doc.save(fileName);
        }

        // Démarrage de l'application
        window.onload = function() {
            loadGitHubConfig();
        };
    </script>
</body>
</html>
